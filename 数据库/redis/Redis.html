<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="823"/>

<div>
<span><div><b><font style="font-size: 36pt;">Redis</font></b></div><div><span style="color: rgb(62, 67, 73); font-family: sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"> </span><a href="http://redis.io/commands" style="color: rgb(197, 47, 36); font-family: sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Redis Command Reference</a><span style="color: rgb(62, 67, 73); font-family: sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span><span style="color: rgb(62, 67, 73); font-family: sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">和</span><span style="color: rgb(62, 67, 73); font-family: sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span><a href="http://redis.io/documentation" style="color: rgb(197, 47, 36); font-family: sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Redis Documentation</a><span style="color: rgb(62, 67, 73); font-family: sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span><span style="color: rgb(62, 67, 73); font-family: sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">的中文翻译版：<a href="http://doc.redisfans.com/" style="font-size: 12pt; color: rgb(62, 67, 73);">http://doc.redisfans.com/</a></span></div><div><hr/><b><font style="font-size: 16pt;">一、说其优点</font></b></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; list-style-type: decimal; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all;"><font style="font-size: 10pt;">1、性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。</font></span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; list-style-type: decimal; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all;"><font style="font-size: 10pt;">2、丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</font></span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; list-style-type: decimal; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all;"><font style="font-size: 10pt;">3、原子 – Redis的所有操作都是原子性的，同时Redis还支持对几个操作全并后的原子性执行。</font></span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; list-style-type: decimal; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all;"><font style="font-size: 10pt;">4、丰富的特性 – Redis还支持 publish/subscribe 通知, key 过期等等特性</font></span><span style="font-size: 10pt;">支持事务。</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 40px; list-style-type: decimal; word-break: break-all;"><span style="font-size: 10pt;"><br/></span></div><div><b><font style="font-size: 16pt;">二、分布式系统的CAP理论：</font></b></div><div><b style="font-size: 21.3333px;">     </b><span style="color: rgb(51, 51, 51); font-family: arial, 宋体, sans-serif; font-size: 14px; text-indent: 2em; text-align: justify;">三个特性归纳：</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; font-size: 16px; color: rgb(79, 79, 79); line-height: 26px; text-align: justify; word-break: break-all; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;">● 一致性（C）：</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;">在分布式系统中的所有数据备份，在同一时刻是否同样的值。（等同于所有节点访问同一份最新的数据副本），换句话就是说，任何时刻，所用的应用程序都能访问得到相同的数据。</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;"><br/></span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;">● 可用性（A）：</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;">在集群中一部分节点故障后，集群整体是否还能响应客户端的读写请求。（对数据更新具备高可用性），换句话就是说，任何时候，任何应用程序都可以读写数据。</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;"><br/></span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;">● 分区容错性（P）：</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-indent: 2em; line-height: 24px; font-family: arial, 宋体, sans-serif;">以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在C和A之间做出选择，换句话说，系统可以跨网络分区线性的伸缩和扩展。</span></div><div>       </div><div>        <b>*三者只能满足其中两条</b><img src="https://img-blog.csdn.net/20161218225320799?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hhbmNlaW4wMDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" style="box-sizing: border-box; outline: 0px; max-width: 100%; word-break: break-all; cursor: zoom-in;"></img></div><div><br/></div><div><span style="font-size: 21.3333px;"><b>三、Redis常用数据类型</b></span></div><div><b style="font-size: 21.3333px;">      </b><font style="font-size: 10pt;">1、String</font> <span style="font-size: 10pt;">      </span></div><div><span style="font-size: 10pt;">              <b>概念：</b></span><span style="font-size: 10pt;">String是简单的key-value键值对，value在redis内存默认情况下是string，当进行incr,decr等数值操作时会转换成数值进行计算，此时内部存储的encoding为int。</span></div><div><span style="font-size: 10pt;">              <b>应用场景：</b>String是最常用的普通的一种key/value键值对。</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">        2、List</span></div><div><span style="font-size: 10pt;">             <b>概念：</b>redis列表是简单的字符串列表，可以从头部或者尾部向其中添加元素，它是一个 双向链表，也或者说是一个队列，因为其双向的特点，所以可以支持反向的查找和遍历，<u style="font-weight: bold;">不过带来的额外的开销</u>，redis内部的很多实现包括发送缓冲队列都是用到了这个数据结构。</span></div><div><span style="font-size: 10pt;">             <b>应用场景</b>：Redis列表List用到的地方很多，比如twitter的关注列表，粉丝列表，等都可以用Redis列表来实现，或者有些应用使用Redis的list类型来实现一个轻量级的消息队列。</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">        3、Hash</span></div><div><span style="font-size: 10pt;">             <b>概念</b>：Redis内部其实就是hashmap实现的，在这里的hash有两种表现形式，一种是当hash成员比较少时，为了节省内存采用一维数组的形式，这时候value在redis内部的encoding为zipmap,当hash成员达到一定程度后，encoding会转为ht，也就是说，内部实现就是hashmap</span></div><div><span style="font-size: 10pt;">             <b>应用场景</b>：假设有多个用户对应其用户信息，每个用户可以以用户ID作为key，将用户信息序列化为比如json格式作为value进行保存。</span></div><div><span style="font-size: 10pt;">  </span></div><div><span style="font-size: 10pt;">        4、Set</span></div><div><span style="font-size: 10pt;">             <b>概念</b>：可以理解为一对值不重复的列表，类似于数学中的集合概念，且redis提供了针对交集，并集，差集等操作，set的内部实现是一个value永远为null的的hashmap，实际是通过计算hash值来解决快速排重的，这也是set快速查找某一元素在集合内的原因。</span></div><div><span style="font-size: 10pt;">             <b>应用场景</b>：redis对外提供的功能与List类似是一个列表的功能，特殊之处在于set是是可以快速排出重复，当要存储一个列表，但又不希望有重复值的情况下，set是一个不错的选择，并且set提供判断某个成员是否在一个set集合内的接口，这也是list不能提供的。</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;">        5、Sorted set</span></div><div>             <b>概念</b> : <span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">Redis有序集合类似Redis集合，不同的是增加了一个功能，即集合是有序的。一个有序集合的每个成员带有分数，用于进行排序。</span><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">Redis有序集合添加、删除和测试的时间复杂度均为O(1)</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">                   Redis sorted set的内部使用HashMap和跳跃表(SkipList)来保证数据的存储和有序，HashMap里放的是成员到score的映射，而跳跃表里存放的是所有的成员，排序依据是HashMap里存的score,使用跳跃表的结构可以获得比较高的查找效率，并且在实现上比较简单。</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">           <b>应用场景</b>：应用场景与set类似，区别在于Sorted set是自动有序的，当需要一个有序且不重复的集合列表的时候，就可以选择Sorted set。</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;"><br/></span></div><div><font style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 16pt;"><b>四、RDB与AOF）（持久化）</b></font></div><div><font style="font-family: Verdana, Arial, Helvetica, sans-serif;"><b style="font-size: 16pt;">       </b><font style="font-size: 10pt;">1、RDB</font></font></div><div><font style="font-family: Verdana, Arial, Helvetica, sans-serif;"><font style="font-size: 10pt;">              RDB快照：通常RDB快照是保存在dump.rdb的二进制文件中的，可以通过SAVE或者BGSAVE直接当下进行快照保存操作。</font></font></div><div><font style="font-family: Verdana, Arial, Helvetica, sans-serif;"><font style="font-size: 10pt;">              <b>概念：</b>RDB持久化是每隔一个时间段就将内存中的数据快照写入磁盘，实际操作就是fork一个子进程，然后写入临时文件，然后再替换掉原来的文件，用二进制进行压缩。</font></font></div><div><font style="font-family: Verdana, Arial, Helvetica, sans-serif;"><font style="font-size: 10pt;">              <b>优点：</b>（1）文件备份只有一个文件，容易查找恢复。 （2）灾难恢复效率高</font></font></div><div><font style="font-family: Verdana, Arial, Helvetica, sans-serif;"><font style="font-size: 10pt;">              <b>缺点：</b>（1）如果在定时任务前出现错误，数据将丢失。 （2）如果数据集较大，将会出现服务器短时间内停止服务。</font></font></div><div><font style="font-family: Verdana, Arial, Helvetica, sans-serif;"><font style="font-size: 10pt;">         2、AOF</font></font></div><div><font style="font-family: Verdana, Arial, Helvetica, sans-serif;"><font style="font-size: 10pt;">              <b>概念</b>：AOF是以日志的形式记录服务器所处理的每个写和删除操作，不会记录读操作，以文本的形式记录，可以通过文件查看，AOF是采用追加的方式进行存储备份的。</font></font></div><div><font style="font-family: Verdana, Arial, Helvetica, sans-serif;"><font style="font-size: 10pt;">              <b>优点</b>：数据安全性较高，可以配置同步持久化。</font></font></div><div><font style="font-family: Verdana, Arial, Helvetica, sans-serif;"><font style="font-size: 10pt;">              <b>缺点</b>：灾难恢复效率较低。</font></font></div><div><font style="font-family: Verdana, Arial, Helvetica, sans-serif;"><font style="font-size: 10pt;">         3、<span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10pt;">Redis持久化</span></font></font><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10pt;"> </span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10pt;">              RDB和AOF可以同时使用，并且在重启服务器的时候，优先使用AOF来还原数据集，因为AOF保存的数据通常比RDB更加完整。</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10pt;">         4、应该使用哪种？</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10pt;">             一般来说，都是使用两种一起，有些应用不在乎几分钟的数据丢失，也是可以只使用RDB的，有些只使用AOF的话，也有些欠妥，毕竟RDB定时生成快照的方式要比AOF更加方便，并且RDB恢复的速度要比AOF快，除此之外更有利于避免因为AOF所产生的BUG。</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 10pt;">  </span></div><div><font style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 16pt;"><b>五、主从复制</b></font></div><div><font style="font-size: 10pt;">         1、概念：主从复制就是多个redis集合在一起，以一个master，多个slave为模式对外提供服务，配置master为写，slave为读，也就是主写从读模式，如果写比较多，那就一般以异步的形式提供服务。<br/></font></div><div><font style="font-size: 10pt;">         2、复制的运作原理：</font></div><div><font style="font-size: 10pt;">              </font><b style="color: rgb(62, 67, 73); font-family: sans-serif;"><font style="font-size: 10pt;"><span style="line-height: 1.5em;-en-paragraph:true;">无论是初次连接还是重新连接， 当建立一个从服务器时， 从服务器都将向主服务器发送一个</span><span style="line-height: 1.5em; background-color: rgb(255, 255, 255);-en-paragraph:true;"> </span><a href="http://doc.redisfans.com/server/sync.html#sync" style="line-height: 1.5em; color: rgb(197, 47, 36); font-style: italic;-en-paragraph:true;">SYNC</a><span style="line-height: 1.5em;-en-paragraph:true;"> </span><span style="line-height: 1.5em;-en-paragraph:true;">命令。</span></font></b><b style="color: rgb(62, 67, 73); font-family: sans-serif;"><font style="font-size: 10pt;"><span style="line-height: 1.5em;-en-paragraph:true;">接到</span><span style="line-height: 1.5em;-en-paragraph:true;"> </span><a href="http://doc.redisfans.com/server/sync.html#sync" style="line-height: 1.5em; color: rgb(197, 47, 36); font-style: italic;-en-paragraph:true;">SYNC</a><span style="line-height: 1.5em; background-color: rgb(255, 255, 255);-en-paragraph:true;"> </span><span style="line-height: 1.5em; background-color: rgb(255, 255, 255);-en-paragraph:true;">命令的主服务器将开始执行</span><span style="line-height: 1.5em; background-color: rgb(255, 255, 255);-en-paragraph:true;"> </span><a href="http://doc.redisfans.com/server/bgsave.html#bgsave" style="line-height: 1.5em; color: rgb(197, 47, 36); background-color: rgb(255, 255, 255); font-style: italic;-en-paragraph:true;">BGSAVE</a><span style="line-height: 1.5em; background-color: rgb(255, 255, 255);-en-paragraph:true;"> </span><span style="line-height: 1.5em;-en-paragraph:true;">， 并在保存操作执行期间， 将所有新执行的写入命令都保存到一个缓冲区里面。</span></font></b><b style="color: rgb(62, 67, 73); font-family: sans-serif;"><font style="font-size: 10pt;"><span style="line-height: 1.5em;-en-paragraph:true;">当</span><span style="line-height: 1.5em;-en-paragraph:true;"> </span><a href="http://doc.redisfans.com/server/bgsave.html#bgsave" style="line-height: 1.5em; color: rgb(197, 47, 36); font-style: italic;-en-paragraph:true;">BGSAVE</a><span style="line-height: 1.5em;-en-paragraph:true;"> </span><span style="line-height: 1.5em;-en-paragraph:true;">执行完毕后， 主服务器将执行保存操作所得的</span><span style="line-height: 1.5em;-en-paragraph:true;"> </span><span style="line-height: 1.5em; font-family: monospace;-en-paragraph:true;">.rdb</span><span style="line-height: 1.5em;-en-paragraph:true;"> </span><span style="line-height: 1.5em;-en-paragraph:true;">文件发送给从服务器， 从服务器接收这个</span><span style="line-height: 1.5em;-en-paragraph:true;"> </span><span style="line-height: 1.5em; font-family: monospace;-en-paragraph:true;">.rdb</span><span style="line-height: 1.5em;-en-paragraph:true;"> </span><span style="line-height: 1.5em;-en-paragraph:true;">文件， 并将文件中的数据载入到内存中。</span></font></b><b><font style="font-size: 10pt;"><span style="line-height: 1.5em; color: rgb(62, 67, 73); font-family: sans-serif;-en-paragraph:true;">之后主服务器会以 Redis 命令协议的格式， 将写命令缓冲区中积累的所有内容都发送给从服务器。</span></font></b></div><div><font style="font-size: 10pt;"><span style="line-height: 1.5em; color: rgb(62, 67, 73); font-family: sans-serif;-en-paragraph:true;"><b>         </b>3、配置</span></font></div><div><font style="font-size: 10pt;"><span style="line-height: 1.5em; color: rgb(62, 67, 73); font-family: sans-serif;-en-paragraph:true;">              第一种：只要在配置文件中加 ：</span></font><span style="background-color: rgb(252, 252, 252); color: rgb(34, 34, 34); font-size: 12px;">slaveof host port  (host为主机ip，port为端口号)</span></div><div><span style="background-color: rgb(252, 252, 252); color: rgb(34, 34, 34); font-size: 12px;">              第二种：调用slaveof host port ，然后同步就会开始</span></div><div><font style="color: rgb(34, 34, 34); font-size: 16pt;"><span style="background-color: rgb(252, 252, 252);"><b><br/></b></span></font></div><div><font color="#222222"><span style="font-size: 21.3333px; background-color: rgb(252, 252, 252);"><b>六、哨兵模式</b></span></font></div><div><font style="color: rgb(34, 34, 34);"><span style="font-size: 21.3333px; background-color: rgb(252, 252, 252);"><b>       </b><span style="color: rgb(62, 67, 73); font-family: sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Redis 的 Sentinel 系统用于管理多个 Redis 服务器（instance）， 该系统执行以下三个任务：</span></span></font></div><div><font style="color: rgb(34, 34, 34);"><span style="font-size: 21.3333px; background-color: rgb(252, 252, 252);"><span style="color: rgb(62, 67, 73); font-family: sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">         1、 监控：Sentinel会不断检查主服务器与从服务器是否运作正常。</span></span></font></div><div><font style="color: rgb(34, 34, 34);"><span style="font-size: 21.3333px; background-color: rgb(252, 252, 252);"><span style="color: rgb(62, 67, 73); font-family: sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">         2、 提醒：当被监控的某个服务器发生问题时候，Sentinel会通过API向管理员或者其他应用程序发送消息。</span></span></font></div><div><font style="color: rgb(34, 34, 34);"><span style="font-size: 21.3333px; background-color: rgb(252, 252, 252);"><span style="color: rgb(62, 67, 73); font-family: sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">         3、 自动故障迁移：当主服务器发生故障停机维护时，主服务器会丢失master角色，Sentinel会选出任意一台从服务器成为主服务器，当主服务器修好以后，再次上线，只能slaveof到现在的主服务器，成为从服务器。</span></span></font></div><div><font style="color: rgb(34, 34, 34); font-size: 16pt;"><span style="background-color: rgb(252, 252, 252);"><b><br/></b></span></font></div><div><font style="color: rgb(34, 34, 34); font-size: 16pt;"><span style="background-color: rgb(252, 252, 252);"><b>七、事务</b></span></font></div><div><font style="color: rgb(34, 34, 34);"><span style="background-color: rgb(252, 252, 252);"><b style="font-size: 18pt;">     </b> <font style="font-size: 10pt;">1、概念：事务是一个单独隔离的操作，具有原子性，事务中的命令要么全部执行，要么全部不执行。</font></span></font></div><div><font style="color: rgb(34, 34, 34);"><span style="background-color: rgb(252, 252, 252);"><font style="font-size: 10pt;">         2、<b>EXEC</b> 负责触发所有命令执行：</font></span></font></div><div><font style="font-size: 12pt; color: rgb(34, 34, 34);">                        -------如果事务开启 </font><b style="color: rgb(34, 34, 34); font-size: 12pt; background-color: rgb(252, 252, 252);">MULTI后，</b><span style="color: rgb(34, 34, 34); font-size: 12pt; background-color: rgb(252, 252, 252);">因为断线而没有成功执行EXEC，那么所有命令都不会执行。</span><br/></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">                    -------另一方面，如果客户端成功开启 <b>EXEC ，</b>那么所有命令都将会执行。</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">        3、例外：如果REDIS因为某些原因被管理员杀死，或者遇到某些硬件故障，那么可能部分事务命令会被成功写入磁盘。</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">                  （如果REDIS在重启之后发现 <b>AOF</b> 存在这样的问题，那么它会退出，汇报这样一个错误，</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">                     使用redis-check-aof可以解决这个问题：</span><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">它会移除AOF中不完整的事务信息，确保服务器能够顺利的启动。）</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">        4、用法：</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">             MULTI用于开启一个事务，总是返回OK，然后便可以向其中输入多条命令，加入到队列中，执行EXEC命令即一次性执行完所有命令。</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">             当然中途可以调用DISCARD来清空所有事务队列，放弃事务的执行。</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">        5、错误</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">            发生在EXEC之前： 这种错误，在redis2.6.2之后，在执行EXEC后，服务器将会记录这些错误，并放弃这个事务的执行。</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">            发生在EXEC之后： 这种错误，没有进行特殊的处理，没有出错的命令照常执行，只有那些没有出错的命令不能够执行。</span></div><div><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px;">        6、为什么不支持回滚？</span></div><div>               Redis 命令只会因为错误的语法而失败（并且这些问题不能在入队时发现），或是命令用在了错误类型的键上面：这也就是说，从实用性的角度来说，失败的命令是由编程错误造成的，而这些错误应该在开发的过程中被发现，而不应  该 出现在生产环境中。因为不需要对回滚进行支持，所以 Redis 的内部可以保持简单且快速。</div></span>
</div></body></html> 
<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="624"/>

<div>
<span><div><h1 style="margin: 0px 0px 15px; padding: 0px 0px 0px 5px; float: left; width: 993.547px; clear: both; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 247, 239);"><span style="color: rgb(70, 70, 70); font-family: verdana, &quot;ms song&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5em; font-size: 36pt;">关于Filter过滤器</span></h1></div><div style="margin: 0px; padding: 0px; clear: both; color: rgb(70, 70, 70); font-family: verdana, &quot;ms song&quot;, Arial, Helvetica, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 247, 239);"></div><div style="margin: 0px 0px 20px; padding: 0px; word-break: break-word;"><h3 style="margin: 10px 0px; padding: 0px;"><span style="line-height: 1.5;">Filter简介</span></h3><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px;">Filter也称之为过滤器，它是Servlet技术中最实用的技术，Web开发人员通过Filter技术，对web服务器管理的所有web资源：例如Jsp, Servlet, 静态图片文件或静态 html 文件等进行拦截，从而实现一些特殊的功能。例如实现URL级别的权限访问控制、过滤敏感词汇、压缩响应信息等一些高级功能。</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px;">它主要用于对用户请求进行预处理，也可以对HttpServletResponse进行后处理。使用Filter的完整流程：Filter对用户请求进行预处理，接着将请求交给Servlet进行处理并生成响应，最后Filter再对服务器响应进行后处理。</span></div><h3 style="margin: 10px 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; font-weight: bold; line-height: 1.5;">Filter功能</span></h3><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><div>在HttpServletRequest到达 Servlet 之前，拦截客户的HttpServletRequest 。根据需要检查HttpServletRequest，也可以修改HttpServletRequest 头和数据。</div><div style="margin-top: 1em; margin-bottom: 1em;">在HttpServletResponse到达客户端之前，拦截HttpServletResponse 。根据需要检查HttpServletResponse，也可以修改HttpServletResponse头和数据。</div></div><h3 style="margin: 10px 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; font-weight: bold; line-height: 1.5;">如何借助Filter实现拦截功能</span></h3><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px;">Filter接口中有一个doFilter方法，当开发人员编写好Filter，并配置对哪个web资源进行拦截后，Web服务器每次在调用web资源的service方法之前，都会先调用一下filter的doFilter方法，因此，在该方法内编写代码可达到如下目的：</span></div><div style="margin: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><div>调用目标资源之前，让一段代码执行。</div><div>是否调用目标资源（即是否让用户访问web资源）。</div><div>web服务器在调用<span style="color: rgb(0, 0, 255);">doFilter方法时，会传递一个filterChain对象进来，filterChain对象是filter接口中最重要的一个对象，它也提供了一个</span><span style="color: rgb(0, 0, 255);">doFilter方法，开发人员可以根据需求决定是否调用此方法，调用该方法，则web服务器就会调用web资源的service方法，即web资源就会被访问，否则web资源不会被访问。</span></div></div><h3 style="margin: 10px 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; font-weight: bold; line-height: 1.5;">Filter开发两步走</span></h3><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><div>编写java类实现Filter接口，并实现其doFilter方法。</div><div style="margin-top: 1em; margin-bottom: 1em;">在web.xml文件中对编写的filter类进行注册，并设置它所能拦截的资源。</div></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px;">web.xml配置各节点介绍：</span></div><div style="margin: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><div><span style="color: rgb(255, 0, 0);">&lt;filter&gt;</span> <span style="color: rgb(0, 0, 255);">指定一个过滤器。</span></div><div><span style="color: rgb(255, 0, 0);">&lt;filter-name&gt;</span><span style="color: rgb(0, 0, 255);">用于为过滤器指定一个名字，该元素的内容不能为空。</span></div><div><span style="color: rgb(255, 0, 0);">&lt;filter-class&gt;</span><span style="color: rgb(0, 0, 255);">元素用于指定过滤器的完整的限定类名。</span></div><div><span style="color: rgb(255, 0, 0);">&lt;init-param&gt;</span><span style="color: rgb(0, 0, 255);">元素用于为过滤器指定初始化参数，它的子元素</span><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-name&gt;指定参数的名字，</span><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-value&gt;指定参数的值。</span></div><div><span style="color: rgb(0, 0, 255);">在过滤器中，可以使用FilterConfig接口对象来访问初始化参数。</span></div><div><span style="color: rgb(255, 0, 0);">&lt;filter-mapping&gt;</span><span style="color: rgb(0, 0, 255);">元素用于设置一个 Filter 所负责拦截的资源。一个Filter拦截的资源可通过两种方式来指定：Servlet 名称和资源访问的请求路径</span></div><div><span style="color: rgb(255, 0, 0);">&lt;filter-name&gt;</span><span style="color: rgb(0, 0, 255);">子元素用于设置filter的注册名称。该值必须是在</span><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">filter&gt;元素中声明过的过滤器的名字</span></div><div><span style="color: rgb(255, 0, 0);">&lt;url-pattern&gt;</span><span style="color: rgb(0, 0, 255);">设置 filter 所拦截的请求路径(过滤器关联的URL样式)</span></div><div><span style="color: rgb(255, 0, 0);">&lt;servlet-name&gt;</span><span style="color: rgb(0, 0, 255);">指定过滤器所拦截的Servlet名称。</span></div><div><span style="color: rgb(255, 0, 0);">&lt;dispatcher&gt;</span><span style="color: rgb(0, 0, 255);">指定过滤器所拦截的资源被 Servlet 容器调用的方式，可以是REQUEST,INCLUDE,FORWARD和ERROR之一，默认REQUEST。用户可以设置多个</span><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">dispatcher&gt;子元素用来指定 Filter 对资源的多种调用方式进行拦截。</span></div><div><span style="color: rgb(255, 0, 0);">&lt;dispatcher&gt;</span><span style="color: rgb(0, 0, 255);">子元素可以设置的值及其意义</span></div><div><span style="color: rgb(229, 0, 255);">REQUEST：</span><span style="color: rgb(0, 0, 255);">当用户直接访问页面时，Web容器将会调用过滤器。如果目标资源是通过RequestDispatcher的include()或forward()方法访问时，那么该过滤器就不会被调用。</span></div><div><span style="color: rgb(229, 0, 255);">INCLUDE：</span><span style="color: rgb(0, 0, 255);">如果目标资源是通过RequestDispatcher的include()方法访问时，那么该过滤器将被调用。除此之外，该过滤器不会被调用。</span></div><div><span style="color: rgb(229, 0, 255);">FORWARD：</span><span style="color: rgb(0, 0, 255);">如果目标资源是通过RequestDispatcher的forward()方法访问时，那么该过滤器将被调用，除此之外，该过滤器不会被调用。</span></div><div><span style="color: rgb(229, 0, 255);">ERROR：</span><span style="color: rgb(0, 0, 255);">如果目标资源是通过声明式异常处理机制调用时，那么该过滤器将被调用。除此之外，过滤器不会被调用。</span></div></div><h3 style="margin: 10px 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; font-weight: bold; line-height: 1.5;">Filter链</span></h3><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px;">在一个web应用中，可以开发编写多个Filter，这些Filter组合起来称之为一个Filter链。</span></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px;">web服务器根据Filter在web.xml文件中的注册顺序，决定先调用哪个Filter，当第一个Filter的doFilter方法被调用时，web服务器会创建一个代表Filter链的FilterChain对象传递给该方法。在doFilter方法中，开发人员如果调用了FilterChain对象的doFilter方法，则web服务器会检查FilterChain对象中是否还有filter，如果有，则调用第2个filter，如果没有，则调用目标资源。</span></div><h3 style="margin: 10px 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; font-weight: bold; line-height: 1.5;">Filter的生命周期</span></h3><div style="margin: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><div><span style="color: rgb(0, 0, 255);">public void</span> <span style="color: rgb(0, 0, 255);">init(</span><span style="color: rgb(163, 21, 21);">FilterConfig filterConfig)</span> <span style="color: rgb(0, 0, 255);">throws</span> <span style="color: rgb(163, 21, 21);">ServletException;</span><span style="color: green;">//初始化</span></div><div><span style="color: green;">和我们编写的</span><span style="color: rgb(163, 21, 21);">Servlet程序一样，</span><span style="color: rgb(163, 21, 21);">Filter的创建和销毁由</span><span style="color: rgb(163, 21, 21);">WEB服务器负责。 web 应用程序启动时，web 服务器将创建</span><span style="color: rgb(163, 21, 21);">Filter 的实例对象，并调用其</span><span style="color: rgb(0, 0, 255);">init方法，读取web.xml配置，完成对象的初始化功能，从而为后续的用户请求作好拦截的准备工作（</span><span style="color: rgb(0, 0, 255);">filter对象只会创建一次，</span><span style="color: rgb(0, 0, 255);">init方法也只会执行一次）。开发人员通过</span><span style="color: rgb(0, 0, 255);">init方法的参数，可获得代表当前</span><span style="color: rgb(0, 0, 255);">filter配置信息的</span><span style="color: rgb(163, 21, 21);">FilterConfig对象。</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">public void doFilter(</span><span style="color: rgb(163, 21, 21);">ServletRequest request,</span> <span style="color: rgb(163, 21, 21);">ServletResponse response,</span> <span style="color: rgb(163, 21, 21);">FilterChain chain)</span> <span style="color: rgb(0, 0, 255);">throws</span> <span style="color: rgb(163, 21, 21);">IOException,</span> <span style="color: rgb(163, 21, 21);">ServletException;</span><span style="color: green;">//拦截请求</span></div><div><span style="color: green;">这个方法完成实际的过滤操作。当客户请求访问与过滤器关联的</span><span style="color: rgb(163, 21, 21);">URL的时候，</span><span style="color: rgb(163, 21, 21);">Servlet过滤器将先执行doFilter方法。</span><span style="color: rgb(163, 21, 21);">FilterChain参数用于访问后续过滤器。</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">public void destroy();</span><span style="color: green;">//销毁</span></div><div><span style="color: rgb(163, 21, 21);">Filter对象创建后会驻留在内存，当web应用移除或服务器停止时才销毁。在</span><span style="color: rgb(163, 21, 21);">Web容器卸载</span> <span style="color: rgb(163, 21, 21);">Filter 对象之前被调用。该方法在</span><span style="color: rgb(163, 21, 21);">Filter的生命周期中仅执行一次。在这个方法中，可以释放过滤器使用的资源。</span></div></div><h3 style="margin: 10px 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; font-weight: bold; line-height: 1.5;">FilterConfig接口</span></h3><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px;">用户在配置filter时，可以使用为filter配置一些初始化参数，当web容器实例化Filter对象，调用其init方法时，会把封装了filter初始化参数的filterConfig对象传递进来。因此开发人员在编写filter时，通过filterConfig对象的方法，就可获得以下内容：</span></div><div style="margin: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><div>String <span style="color: rgb(163, 21, 21);">getFilterName</span><span style="color: rgb(163, 21, 21);">();</span><span style="color: green;">//得到filter的名称。</span></div><div><span style="color: green;">String</span> <span style="color: rgb(163, 21, 21);">getInitParameter</span><span style="color: rgb(163, 21, 21);">(String name);</span><span style="color: green;">//返回在部署描述中指定名称的初始化参数的值。如果不存在返回null.</span></div><div><span style="color: green;">Enumeration</span> <span style="color: rgb(163, 21, 21);">getInitParameterNames</span><span style="color: rgb(163, 21, 21);">();</span><span style="color: green;">//返回过滤器的所有初始化参数的名字的枚举集合。</span></div><div><span style="color: rgb(0, 0, 255);">public ServletContext</span> <span style="color: rgb(163, 21, 21);">getServletContext</span><span style="color: rgb(163, 21, 21);">();</span><span style="color: green;">//返回Servlet上下文对象的引用。</span></div></div><h3 style="margin: 10px 0px; padding: 0px; font-size: 16px;"><span style="font-size: 16px; font-weight: bold; line-height: 1.5;">Filter使用案例</span></h3><h4 style="margin: 10px 0px; padding: 0px; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-weight: bold;">使用Filter验证用户登录安全控制</span></h4><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px;">前段时间参与维护一个项目，用户退出系统后，再去地址栏访问历史，根据url，仍然能够进入系统响应页面。我去检查一下发现对请求未进行过滤验证用户登录。添加一个filter搞定问题！</span></div><h5 style="margin: 10px 0px; padding: 0px; font-size: 12px;"><span style="font-size: 12px; color: rgb(51, 51, 51); font-weight: bold;">先在web.xml配置</span></h5><div style="margin: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">filter&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">filter-name&gt;SessionFilter</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">filter-name&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">filter-class&gt;com.action.login.SessionFilter</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">filter-class&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">init-param&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-name&gt;logonStrings</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">param-name&gt;</span><span style="color: green;">&lt;!-- 对登录页面不进行过滤 --&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-value&gt;/project/index.jsp;login.do</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">param-value&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">init-param&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">init-param&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-name&gt;includeStrings</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">param-name&gt;</span><span style="color: green;">&lt;!-- 只对指定过滤参数后缀进行过滤 --&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-value&gt;.do;.jsp</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">param-value&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">init-param&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">init-param&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-name&gt;redirectPath</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">param-name&gt;</span><span style="color: green;">&lt;!-- 未通过跳转到登录界面 --&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-value&gt;/index.jsp</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">param-value&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">init-param&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">init-param&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-name&gt;disabletestfilter</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">param-name&gt;</span><span style="color: green;">&lt;!-- Y:过滤无效 --&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-value&gt;N</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">param-value&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">init-param&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">filter&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">filter-mapping&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">filter-name&gt;SessionFilter</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">filter-name&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">url-pattern&gt;/*</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">url-pattern&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">filter-mapping&gt;</span></div></div><h5 style="margin: 10px 0px; padding: 0px; font-size: 12px;"><span style="font-size: 12px; color: rgb(51, 51, 51); font-weight: bold;">接着编写FilterServlet</span></h5><div style="margin: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><div>package com.action.login;</div><div><br/></div><div><span style="color: rgb(0, 0, 255);">import java.io.IOException;</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">import javax.servlet.Filter;</span></div><div><span style="color: rgb(0, 0, 255);">import javax.servlet.FilterChain;</span></div><div><span style="color: rgb(0, 0, 255);">import javax.servlet.FilterConfig;</span></div><div><span style="color: rgb(0, 0, 255);">import javax.servlet.ServletException;</span></div><div><span style="color: rgb(0, 0, 255);">import javax.servlet.ServletRequest;</span></div><div><span style="color: rgb(0, 0, 255);">import javax.servlet.ServletResponse;</span></div><div><span style="color: rgb(0, 0, 255);">import javax.servlet.http.HttpServletRequest;</span></div><div><span style="color: rgb(0, 0, 255);">import javax.servlet.http.HttpServletResponse;</span></div><div><span style="color: rgb(0, 0, 255);">import javax.servlet.http.HttpServletResponseWrapper;</span></div><div><br/></div><div><span style="color: green;">/**</span></div><div><span style="color: green;">* 判断用户是否登录,未登录则退出系统</span></div><div><span style="color: green;">*/</span></div><div><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">class SessionFilter</span> <span style="color: rgb(0, 0, 255);">implements Filter {</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">public FilterConfig config;</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">void destroy() {</span></div><div><span style="color: rgb(0, 0, 255);">this.config =</span> <span style="color: rgb(163, 21, 21);">null;</span></div><div><span style="color: rgb(163, 21, 21);">}</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">static</span> <span style="color: rgb(0, 0, 255);">boolean isContains(</span><span style="color: rgb(0, 0, 255);">String container,</span> <span style="color: rgb(0, 0, 255);">String[] regx) {</span></div><div><span style="color: rgb(0, 0, 255);">boolean result =</span> <span style="color: rgb(163, 21, 21);">false;</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">for (int i =</span> <span style="color: rgb(0, 0, 255);">0; i &lt; regx.length; i++) {</span></div><div><span style="color: rgb(0, 0, 255);">if (container.indexOf(regx[i]) !=</span> <span style="color: rgb(0, 0, 255);">-1) {</span></div><div><span style="color: rgb(0, 0, 255);">return</span> <span style="color: rgb(163, 21, 21);">true;</span></div><div><span style="color: rgb(163, 21, 21);">}</span></div><div><span style="color: rgb(163, 21, 21);">}</span></div><div><span style="color: rgb(0, 0, 255);">return result;</span></div><div><span style="color: rgb(0, 0, 255);">}</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {</span></div><div><span style="color: rgb(0, 0, 255);">HttpServletRequest hrequest = (HttpServletRequest)request;</span></div><div><span style="color: rgb(0, 0, 255);">HttpServletResponseWrapper wrapper =</span> <span style="color: rgb(0, 0, 255);">new HttpServletResponseWrapper((HttpServletResponse) response);</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">String logonStrings = config.getInitParameter(</span><span style="color: rgb(163, 21, 21);">&quot;logonStrings&quot;);</span> <span style="color: green;">// 登录登陆页面</span></div><div><span style="color: rgb(0, 0, 255);">String includeStrings = config.getInitParameter(</span><span style="color: rgb(163, 21, 21);">&quot;includeStrings&quot;);</span> <span style="color: green;">// 过滤资源后缀参数</span></div><div><span style="color: rgb(0, 0, 255);">String redirectPath = hrequest.getContextPath() + config.getInitParameter(</span><span style="color: rgb(163, 21, 21);">&quot;redirectPath&quot;);</span><span style="color: green;">// 没有登陆转向页面</span></div><div><span style="color: rgb(0, 0, 255);">String disabletestfilter = config.getInitParameter(</span><span style="color: rgb(163, 21, 21);">&quot;disabletestfilter&quot;);</span><span style="color: green;">// 过滤器是否有效</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">if (disabletestfilter.toUpperCase().equals(</span><span style="color: rgb(163, 21, 21);">&quot;Y&quot;)) {</span> <span style="color: green;">// 过滤无效</span></div><div><span style="color: green;">chain.doFilter(request, response);</span></div><div><span style="color: rgb(0, 0, 255);">return;</span></div><div><span style="color: rgb(0, 0, 255);">}</span></div><div><span style="color: rgb(0, 0, 255);">String[] logonList = logonStrings.split(</span><span style="color: rgb(163, 21, 21);">&quot;;&quot;);</span></div><div><span style="color: rgb(0, 0, 255);">String[] includeList = includeStrings.split(</span><span style="color: rgb(163, 21, 21);">&quot;;&quot;);</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">if (!</span><span style="color: rgb(0, 0, 255);">this.isContains(hrequest.getRequestURI(), includeList)) {</span><span style="color: green;">// 只对指定过滤参数后缀进行过滤</span></div><div><span style="color: green;">chain.doFilter(request, response);</span></div><div><span style="color: rgb(0, 0, 255);">return;</span></div><div><span style="color: rgb(0, 0, 255);">}</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">if (</span><span style="color: rgb(0, 0, 255);">this.isContains(hrequest.getRequestURI(), logonList)) {</span><span style="color: green;">// 对登录页面不进行过滤</span></div><div><span style="color: green;">chain.doFilter(request, response);</span></div><div><span style="color: rgb(0, 0, 255);">return;</span></div><div><span style="color: rgb(0, 0, 255);">}</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">String user = (</span> <span style="color: rgb(0, 0, 255);">String ) hrequest.getSession().getAttribute(</span><span style="color: rgb(163, 21, 21);">&quot;useronly&quot;);</span><span style="color: green;">//判断用户是否登录</span></div><div><span style="color: rgb(0, 0, 255);">if (user ==</span> <span style="color: rgb(163, 21, 21);">null) {</span></div><div><span style="color: rgb(163, 21, 21);">wrapper.sendRedirect(redirectPath);</span></div><div><span style="color: rgb(0, 0, 255);">return;</span></div><div><span style="color: rgb(0, 0, 255);">}</span><span style="color: rgb(0, 0, 255);">else {</span></div><div><span style="color: rgb(0, 0, 255);">chain.doFilter(request, response);</span></div><div><span style="color: rgb(0, 0, 255);">return;</span></div><div><span style="color: rgb(0, 0, 255);">}</span></div><div><span style="color: rgb(0, 0, 255);">}</span></div><div><br/></div><div><span style="color: rgb(0, 0, 255);">public</span> <span style="color: rgb(0, 0, 255);">void init(FilterConfig filterConfig) throws ServletException {</span></div><div><span style="color: rgb(0, 0, 255);">config = filterConfig;</span></div><div><span style="color: rgb(0, 0, 255);">}</span></div><div><span style="color: rgb(0, 0, 255);">}</span></div></div><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px;">这样既可完成对用户所有请求，均要经过这个Filter进行验证用户登录。</span></div><h4 style="margin: 10px 0px; padding: 0px; font-size: 14px;"><span style="font-size: 14px; color: rgb(51, 51, 51); font-weight: bold;">防止中文乱码过滤器</span></h4><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="text-indent: 0px;">项目使用spring框架时。当前台JSP页面和Java代码中使用了不同的字符集进行编码的时候就会出现表单提交的数据或者上传/下载中文名称文件出现乱码的问题，那就可以使用这个过滤器。</span></div><div style="margin: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">filter&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">filter-name&gt;encoding</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">filter-name&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">filter-class&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">init-param&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-name&gt;encoding</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">param-name&gt;</span><span style="color: green;">&lt;!--用来指定一个具体的字符集--&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-value&gt;UTF-8</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">param-value&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">init-param&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">init-param&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-name&gt;forceEncoding</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">param-name&gt;</span><span style="color: green;">&lt;!--true：无论request是否指定了字符集，都是用encoding；false：如果request已指定一个字符集，则不使用encoding--&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">param-value&gt;false</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">param-value&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">init-param&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">filter&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">filter-mapping&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">filter-name&gt;encoding</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">filter-name&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;</span><span style="color: rgb(0, 0, 255);">url-pattern&gt;/*</span><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">url-pattern&gt;</span></div><div><span style="color: rgb(0, 0, 255);">&lt;/</span><span style="color: rgb(0, 0, 255);">filter-mapping&gt;</span></div></div></div><div><br/></div></span>
</div></body></html> 
<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="833"/>

<div>
<span><div><div><b><font style="font-size: 24pt;">Druid数据库连接池介绍与使用</font></b></div><div><hr/><br/></div><div>一、简要介绍</div><div>       </div><div>      </div><div>       Druid数据源连接池来源于阿里巴巴，是淘宝和支付宝专用数据库连接池。事实上，它不仅仅是一个数据库连接池，还包含一个ProxyDriver、一系列内置的JDBC组件库、一个 SQL Parser。支持所有JDBC兼容的数据库，包括Oracle、MySql、Derby、Postgresql、SQL Server、H2等等。Druid针对Oracle和MySql做了特别优化，比如Oracle的PSCache内存占用优化，MySql的ping检测优化。Druid提供了诸如MySql、Oracle、Postgresql、SQL-92等SQL语句的完美支持，是一个手写的高性能SQL Parser，支持Visitor模式，使得分析SQL的抽象语法树很方便。它执行简单SQL语句耗时在10微秒以内，对于复杂的SQL语句耗时也在30微秒左右。另外，通过Druid提供的SQL Parser可以在JDBC层面上拦截SQL并进行相应处理，比如说分库分表、SQL安全审计等。Druid也能防御SQL注入攻击，WallFilter就是通过Druid的SQL Parser分析语义实现的。</div><div><br/></div><div>二、实例demo测试</div><div>       1、首先添加Druid依赖，访问 <a href="http://mvnrepository.com/artifact/com.alibaba/druid" style="box-sizing: border-box; color: rgb(49, 148, 208); cursor: pointer; outline: 0px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration: underline;">mvnrepository.com/artifact/com.alibaba/druid</a> 选择需要的版本，复制maven内容到pom.xml，<groupId>内的内容换成druid-spring-boot-starter就能监控到sql了</div><div>       2、添加Druid配置到application.yml中，核心代码如下,可直接复制使用：</div><div>            <br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">spring:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">datasource:</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">url:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">jdbc:mysql://127.0.0.1:3306/test?characterEncoding=utf8</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">driver-class-name:</span> <span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">com</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">mysql</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">jdbc</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Driver</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">username:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">root</span></div><div style="font-family: Monaco; font-size: 9pt;"><span style="color: rgb(85, 255, 85); font-weight: bold; font-family: Monaco; font-size: 9pt;">password:  </span><span style="font-family: Monaco; font-size: 9pt;"><font color="#000000">root</font></span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-weight: bold; font-family: Monaco; font-size: 9pt;">#配置监控统计拦截的filters，去掉后监控界面sql将无法统计，“wall”用于防火墙</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">filters:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">stat,wall,log4j</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-weight: bold; font-family: Monaco; font-size: 9pt;">#最大活跃数</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">maxActive:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">20</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-weight: bold; font-family: Monaco; font-size: 9pt;">#初始化数量</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">initialSize:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-weight: bold; font-family: Monaco; font-size: 9pt;">#最大连接等待超时时间</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">maxWait:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">60000</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-weight: bold; font-family: Monaco; font-size: 9pt;">#打开PSCache,并且制定每个连接PSCache的大小</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">poolPreparedStatements:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">true</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">maxPoolPreparedStatementPerConnectionSize:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">20</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-weight: bold; font-family: Monaco; font-size: 9pt;">#通过connectionProperties属性打开mergeSql功能；慢sql记录</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">connectionProperties:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">minldle:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">1</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">timeBetweenEvictionRunsMillis:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">60000</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">minEvictableldleTimeMillis:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">300000</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">validationQuery:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">select 1 from dual</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">testWhileldle:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">true</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">testOnBorrow:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">false</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">testOnReturn:</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">false</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">type:</span> <span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">com</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">alibaba</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">druid</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">pool</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">DruidDataSource</span></div></div><div>     </div><div>       3、开启Druis监控功能，新建类<span style="background-color: rgb(0, 0, 0); color: rgb(187, 187, 187); font-family: 宋体; font-size: 12pt; font-weight: bold;">DruidConfiguration.java</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">package</span> <span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">com</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">wj</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">demo1</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">import</span> <span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">com</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">alibaba</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">druid</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">support</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">StatViewServlet</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">import</span> <span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">com</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">alibaba</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">druid</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">support</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">http</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">WebStatFilter</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">import</span> <span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">org</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">springframework</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">boot</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">web</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">servlet</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">FilterRegistrationBean</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">import</span> <span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">org</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">springframework</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">boot</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">web</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">servlet</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ServletRegistrationBean</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">import</span> <span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">org</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">springframework</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">context</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">annotation</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="color: #55ffff; font-weight: bold; font-family: Monaco; font-size: 9pt;">Bean</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">import</span> <span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">org</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">springframework</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">context</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">annotation</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="color: #55ffff; font-weight: bold; font-family: Monaco; font-size: 9pt;">Configuration</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-weight: bold; font-family: Monaco; font-size: 9pt;">@Configuration</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">public class</span> <span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">DruidConfiguration</span> <span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">{</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-weight: bold; font-family: Monaco; font-size: 9pt;">@Bean</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">public</span> <span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ServletRegistrationBean</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">statViewServlet</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">(){</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">//创建servlet注册实体</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ServletRegistrationBean</span> <span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">servletRegistrationBean</span> <span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">=</span> <span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">new</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ServletRegistrationBean</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">(</span><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">new</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">StatViewServlet</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">()</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">,</span><span style="color: #ff55ff; font-family: Monaco; font-size: 9pt;">&quot;/druid/*&quot;</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">)</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">//设置ip白名单</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">servletRegistrationBean</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">addInitParameter</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">(</span><span style="color: #ff55ff; font-family: Monaco; font-size: 9pt;">&quot;allow&quot;</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">,</span><span style="color: #ff55ff; font-family: Monaco; font-size: 9pt;">&quot;127.0.0.1&quot;</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">)</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">//设置控制台管理用户</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">servletRegistrationBean</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">addInitParameter</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">(</span><span style="color: #ff55ff; font-family: Monaco; font-size: 9pt;">&quot;loginUsername&quot;</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">,</span><span style="color: #ff55ff; font-family: Monaco; font-size: 9pt;">&quot;druid&quot;</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">)</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">servletRegistrationBean</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">addInitParameter</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">(</span><span style="color: #ff55ff; font-family: Monaco; font-size: 9pt;">&quot;loginPassword&quot;</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">,</span><span style="color: #ff55ff; font-family: Monaco; font-size: 9pt;">&quot;123456&quot;</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">)</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">//是否可以重置数据</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">servletRegistrationBean</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">addInitParameter</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">(</span><span style="color: #ff55ff; font-family: Monaco; font-size: 9pt;">&quot;resetEnable&quot;</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">,</span><span style="color: #ff55ff; font-family: Monaco; font-size: 9pt;">&quot;false&quot;</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">)</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">return</span> <span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">servletRegistrationBean</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">}</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-weight: bold; font-family: Monaco; font-size: 9pt;">@Bean</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">public</span> <span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">FilterRegistrationBean</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">statFileter</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">(){</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">//创建过滤器</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">FilterRegistrationBean</span> <span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">filterRegistrationBean</span> <span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">=</span> <span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">new</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">FilterRegistrationBean</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">((</span><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">new</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">WebStatFilter</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">()))</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">//设置过滤器过滤路径</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">filterRegistrationBean</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">addUrlPatterns</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">(</span><span style="color: #ff55ff; font-family: Monaco; font-size: 9pt;">&quot;/*&quot;</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">)</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">//忽略过滤的形式</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">filterRegistrationBean</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">.</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">addInitParameter</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">(</span><span style="color: #ff55ff; font-family: Monaco; font-size: 9pt;">&quot;exclusions&quot;</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">,</span><span style="color: #ff55ff; font-family: Monaco; font-size: 9pt;">&quot;*.js*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">)</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #55ff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">return</span> <span style="color: #55ffff; font-family: Monaco; font-size: 9pt;">filterRegistrationBean</span><span style="color: #ffff55; font-weight: bold; font-family: Monaco; font-size: 9pt;">;</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">}</span></div><div style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span style="color: #ff5555; font-weight: bold; font-family: Monaco; font-size: 9pt;">}</span></div></div><div>         4、运行项目， <span style="color: rgb(47, 47, 47); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">项目运行成功后，我们要访问Druid的监控界面，访问地址：</span><a href="http://127.0.0.1:8080/druid/login.html" style="box-sizing: border-box; color: rgb(49, 148, 208); cursor: pointer; outline: 0px; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 16px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration: underline;">127.0.0.1:8080/d ruid/login.html</a> 到达登录页面，</div><div>              输入<span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">DruidConfiguration.java中配置的用户名和密码，即可登录到我们的服务器监控页面</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;"><br/></span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="color: rgb(51, 51, 51); font-family: Monaco; font-size: 9pt; font-weight: bold;">我们已经成功的访问到了监控首页，可以看到大致包含了如下几个模块：数据源、SQL监控、SQL防火墙、Web应用、URI监控、Session监控、JSONAPI等。</span><br/></div><h4><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">数据源</span></h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">可以看到项目中管理的所有数据源配置的详细情况，除了密码没有显示外其他都在。</span></div><h4><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">SQL监控</span></h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">可以查看所有的执行sql语句</span></div><h4><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">SQL防火墙</span></h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">druid提供了黑白名单的访问，可以清楚的看到sql防护情况。</span></div><h4><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Web应用</span></h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">可以看到目前运行的web程序的详细信息。</span></div><h4><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">URI监控</span></h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">可以监控到所有的请求路径的请求次数、请求时间等其他参数。</span></div><h4><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Session监控</span></h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">可以看到当前的session状况，创建时间、最后活跃时间、请求次数、请求时间等详细参数。</span></div><h4><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">JSONAPI</span></h4><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);-en-paragraph:true;">通过api的形式访问Druid的监控接口，api接口返回Json形式数据。</span></div></div></span>
</div></body></html> 